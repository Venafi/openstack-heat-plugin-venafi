# http://docs.openstack.org/developer/heat/template_guide/hot_spec.html#heat-template-version
heat_template_version: 2014-10-16


description: >
   Venafi testing certificate

parameters:
  #Subject parameters
  common_name:
    type: string
    label: Common Name
    description: Name of key-pair to be used for compute instance
    default: 'fake.cert.example.com'
  sans:
    type: comma_delimited_list
    default: []
  #TPP credentials parameters
  tpp_user:
    type: string
    default: ""
  tpp_password:
    type: string
    default: ""
    hidden: true
  access_token:
    type: string
    default: ""
    hidden: true
  #Cloud credentials parameters
  api_key:
    type: string
    default: ""
    hidden: true
  #Conection parameters
  venafi_url:
    type: string
    default: ""
  trust_bundle:
    type: string
    default: ""
  #TPP or Cloud policy name
  zone:
    type: string
    default: "Default"
  #Set it to true if you want to use face connecto for testing purposes
  fake:
    type: boolean
    default: "false"
  #Save or not to save private key in stack
  save_private_key:
    type: boolean
    default: "true"

resources:
  venafi_certificate:
    type: OS::Nova::VenafiCertificate
    properties:
      name: 'venafi certificate'
      zone: { get_param: zone }
      common_name: { get_param: common_name }
      venafi_url: { get_param: venafi_url }
      api_key: { get_param: api_key }
      tpp_user: { get_param: tpp_user }
      tpp_password: { get_param: tpp_password }
      access_token: { get_param: access_token }
      fake: { get_param: fake }
      trust_bundle: { get_param: trust_bundle }
      save_private_key: { get_param: save_private_key }
      sans:
        { get_param: sans }

outputs:
  venafi_certificate:
    value: { get_attr: [venafi_certificate, certificate] }
  venafi_chain:
    value: { get_attr: [venafi_certificate, chain] }
  venafi_pkey:
    value: { get_attr: [venafi_certificate, private_key] }
  venafi_csr:
    value: { get_attr: [venafi_certificate, csr] }